{"remainingRequest":"/home/lubuntu/src/nodejs/mapjs/mapbojs_testapp/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lubuntu/src/nodejs/mapjs/mapbojs_testapp/src/components/Map1.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lubuntu/src/nodejs/mapjs/mapbojs_testapp/src/components/Map1.vue","mtime":1602479691586},{"path":"/home/lubuntu/src/nodejs/mapjs/mapbojs_testapp/node_modules/cache-loader/dist/cjs.js","mtime":1602479446384},{"path":"/home/lubuntu/src/nodejs/mapjs/mapbojs_testapp/node_modules/babel-loader/lib/index.js","mtime":1602479446372},{"path":"/home/lubuntu/src/nodejs/mapjs/mapbojs_testapp/node_modules/cache-loader/dist/cjs.js","mtime":1602479446384},{"path":"/home/lubuntu/src/nodejs/mapjs/mapbojs_testapp/node_modules/vue-loader/lib/index.js","mtime":1602479445280}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KCmltcG9ydCBtYXBib3hnbCBmcm9tICdtYXBib3gtZ2wnOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwoKdmFyIE1hcE1peGluID0gIHsKICBuYW1lOiAnTWFwMScsCiAgcHJvcHM6IHsKICAgIG1zZzogU3RyaW5nLAogIH0sCiAgJF9tYXA6IG51bGwsICAvLyBkb2VzIHRoaXMgaGVscD8KICAkX3BvaXM6W10sIC8vIGRvZXMgdGhpcyBoZWxwPwogIG1vdW50ZWQoKXsKICAgIC8vIEZldGNoIGRhdGEgZnJvbSBkYXRhIHNlcnZlci4KICAgIHRoaXMuJF9wb2lzID0gW107CiAgICBmZXRjaF9kYXRhKHRoaXMpOwogICAgLy8gaW5pdCBNYXBib3gKICAgIG1hcGJveGdsLmFjY2Vzc1Rva2VuID0gJ3BrLmV5SjFJam9pYlc5dk1TSXNJbUVpT2lKamEyWjZNRzV0Wnpnd2FISmpNelJ1ZEhkcVkzTjVhRzA1SW4wLkxfWUl2a29CNjdBVFpWREhPWlhEU2cnOwogICAgdGhpcy4kX21hcCA9IG5ldyBtYXBib3hnbC5NYXAoewogICAgICAgIGNvbnRhaW5lcjogJ21hcCcsCiAgICAgICAgc3R5bGU6ICdtYXBib3g6Ly9zdHlsZXMvbWFwYm94L3N0cmVldHMtdjExJywgLy8gc3R5bGVzaGVldCBsb2NhdGlvbgogICAgICAgIGNlbnRlcjogWy03NC41LCA0MF0sIC8vIHN0YXJ0aW5nIHBvc2l0aW9uIFtsbmcsIGxhdF0KICAgICAgICB6b29tOiAxMCAvLyBzdGFydGluZyB6b29tCiAgICB9KTsKICAgIHZhciBuYXYgPSBuZXcgbWFwYm94Z2wuTmF2aWdhdGlvbkNvbnRyb2woKTsKICAgIHRoaXMuJF9tYXAuYWRkQ29udHJvbChuYXYsICd0b3AtbGVmdCcpOwoKICB9Cn0KCmZ1bmN0aW9uIGZldGNoX2RhdGEob2JqKSB7CiAgY29uc3QgZGF0YV91cmwgPSAnaHR0cHM6Ly9naXN0LmdpdGh1YnVzZXJjb250ZW50LmNvbS9sYnVkLzM1ZTQ4NDdkMTNlNTUyNGQwOGQzZTU0NzMxOGNmNjg5L3Jhdy9kNDQ5NDBjMTNlNzBiMmJiNjgzMzQ1YzUxMWY4NWQyNDllZTVjY2ZjL3N0YXJidWNrcy5jc3YnOwogIGF4aW9zLmdldChkYXRhX3VybCwgewogICAgcGFyYW1zOiB7fSwKICB9KS50aGVuKCh7IGRhdGEgfSkgPT4gewogICAgLy8gc3BsaXQgaW50byBsaW5lcwogICAgbGV0IGxpbmVzID0gMDsKICAgIGZvciAodmFyIGwgb2YgZGF0YS5zcGxpdCgiXG4iKSkgewogICAgICAvLyBza2lwIHRoZSBmaXJzdCBsaW5lCiAgICAgIGlmIChsaW5lcz4wKSB7CiAgICAgICAgbGV0IHNiID0gewogICAgICAgICAgcGhvbmVfbnVtYmVyOiAnJywKICAgICAgICAgIHN0cmVldDogJycsCiAgICAgICAgICBjaXR5OiAnJywKICAgICAgICAgIGxhdDogMC4wLAogICAgICAgICAgbG5nOiAwLjAKICAgICAgICB9OwogICAgICAgIC8vIHNwbGl0IGJ5IGNvbW1hCiAgICAgICAgbGV0IGl0ZW1zID0gcGFyc2VfY3N2KGwpOwogICAgICAgIC8vY29uc29sZS5sb2coaXRlbXMpOwogICAgICAgIGlmIChpdGVtcy5sZW5ndGg9PTE5KSB7CiAgICAgICAgICBzYi5waG9uZV9udW1iZXIgPSBpdGVtc1s1XTsKICAgICAgICAgIHNiLnN0cmVldCA9IGl0ZW1zWzddOwogICAgICAgICAgc2IuY2l0eSA9IGl0ZW1zWzExXTsKICAgICAgICAgIHNiLmxhdCA9IHBhcnNlRmxvYXQoaXRlbXNbMTRdKTsKICAgICAgICAgIHNiLmxuZyA9IHBhcnNlRmxvYXQoaXRlbXNbMTVdKTsKICAgICAgICAgIG9iai4kX3BvaXMucHVzaChzYik7CiAgICAgICAgICBjb25zb2xlLmxvZyhzYik7CiAgICAgICAgICAvLyBhZGRpbmcgYSBtYXJrZXIKICAgICAgICAgIHZhciBtYXJrZXIgPSBuZXcgbWFwYm94Z2wuTWFya2VyKHtjb2xvcjonIzAwNzA0YSd9KTsKICAgICAgICAgIG1hcmtlci5zZXRMbmdMYXQoW3NiLmxuZywgc2IubGF0XSk7CiAgICAgICAgICBtYXJrZXIuc2V0UG9wdXAobmV3IG1hcGJveGdsLlBvcHVwKCkuCiAgICAgICAgICAgIHNldEhUTUwoYDxkaXYgY2xhc3M9InBvaXBvcHVwIj5BZGRyZXNzOiAke3NiLnN0cmVldH08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icG9pcG9wdXAiPlBob25lOiAke3NiLnBob25lX251bWJlcn08L2RpdmApKTsKICAgICAgICAgIG1hcmtlci5hZGRUbyhvYmouJF9tYXApOwogICAgICAgIH0KICAgICAgfQogICAgICBsaW5lcysrOwogICAgfQogICAgLy8gbW92ZSB0aGUgY2VudGVyCiAgICBsZXQgYyA9IGNlbnRlcihvYmouJF9wb2lzKTsKICAgIG9iai4kX21hcC5zZXRDZW50ZXIoW2NbMV0sIGNbMF1dKTsKICB9KTsKCn0KCi8vIGF2ZXJhZ2Ugb2YgTGF0L0xuZwpmdW5jdGlvbiBjZW50ZXIocG9pcykgewogIGxldCBuID0gcG9pcy5sZW5ndGg7CiAgbGV0IGxhdCA9IDAuMDsKICBsZXQgbG5nID0gMC4wOwogIGZvciAobGV0IHAgb2YgcG9pcykgewogICAgbGF0ICs9IHAubGF0OwogICAgbG5nICs9IHAubG5nOwogIH0KICByZXR1cm4gW2xhdC9uLCBsbmcvbl07Cn0KCi8vCmZ1bmN0aW9uIHBhcnNlX2NzdihzdHIpIHsKICBsZXQgY3MgPSBzdHIuc3BsaXQoJywnKTsKICBsZXQgdG1wcyA9ICIiOwogIGxldCByZXN1bHQgPSBbXTsKICBmb3IgKHZhciBpdG0gb2YgY3MpIHsKICAgIGxldCBzID0gaXRtLnRyaW0oKTsKICAgIGlmICh0bXBzLmxlbmd0aD4wKSB7CiAgICAgIHRtcHMgKz0gczsKICAgICAgaWYgKHMuY2hhckF0KHMubGVuZ3RoLTEpPT09JyInKSB7CiAgICAgICAgLy8gY2xvc2luZyBxdW90ZQogICAgICAgIHJlc3VsdC5wdXNoKHRtcHMuc3Vic3RyKDAsIHMubGVuZ3RoLTIpKTsKICAgICAgICB0bXBzID0gJyc7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAocy5jaGFyQXQoMCk9PT0nIicpIHsKICAgICAgLy8gc3RhcnRpbmcgcXVvdGUKICAgICAgdG1wcyA9IHMuc3Vic3RyKDEsIHMubGVuZ3RoLTEpOwogICAgfSBlbHNlIHsKICAgICAgcmVzdWx0LnB1c2gocyk7CiAgICB9CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KLy8gdGVzdC4uLgovL2NvbnNvbGUubG9nKHBhcnNlX2NzdignVVMsMTUyOTgsR3JhbmQgQ2VudHJhbCxTdGFyYnVja3MsNzgwMC02NzYwMCwyMTItMzcwLTQxNjEsQ08sIjc4MDAgR3JhbmQgQ2VudHJhbCBTdGF0aW9uLCBUcmFjayAzNSwgR3JhbmQgQ2VudHJhbCBTdGF0aW9uIiw3ODAwIEdyYW5kIENlbnRyYWwgU3RhdGlvbixUcmFjayAzNSxHcmFuZCBDZW50cmFsIFN0YXRpb24sTmV3IFlvcmssTlksMTAwMTcsNDAuNzUzNjY5NzM4NzY5NTMxLC03My45NzY3OTEzODE4MzU5MzgsRWFzdGVybiBTdGFuZGFyZCBUaW1lLC0zMDAsR01ULTA1OjAwIEFtZXJpY2EvTmV3X1lvcmsnKSk7Ci8vY29uc29sZS5sb2cocGFyc2VfY3N2KCdVUyw2NTkwLDg4dGggJiBCcm9hZHdheSxTdGFyYnVja3MsMTQ0OTgtMTIxMjY0LDIxMi01OTUtMzQwNCxDTywyMzk0IEJyb2Fkd2F5LDIzOTQgQnJvYWR3YXksLCxOZXcgWW9yayxOWSwxMDAyNDE3MDMsNDAuNzg5Mjg3NTY3MTM4NjcyLC03My45NzUzMjY1MzgwODU5MzgsRWFzdGVybiBTdGFuZGFyZCBUaW1lLC0zMDAsR01ULTA1OjAwIEFtZXJpY2EvTmV3X1lvcmsnKSk7CgpleHBvcnQgZGVmYXVsdCBNYXBNaXhpbjsK"},{"version":3,"sources":["Map1.vue"],"names":[],"mappings":";;;;;;AAMA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"Map1.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div id='map' style='width: 600px; height: 480px;'></div>\n</template>\n\n\n<script>\n  import mapboxgl from 'mapbox-gl';\n  import axios from 'axios';\n\n  var MapMixin =  {\n    name: 'Map1',\n    props: {\n      msg: String,\n    },\n    $_map: null,  // does this help?\n    $_pois:[], // does this help?\n    mounted(){\n      // Fetch data from data server.\n      this.$_pois = [];\n      fetch_data(this);\n      // init Mapbox\n      mapboxgl.accessToken = 'pk.eyJ1IjoibW9vMSIsImEiOiJja2Z6MG5tZzgwaHJjMzRudHdqY3N5aG05In0.L_YIvkoB67ATZVDHOZXDSg';\n      this.$_map = new mapboxgl.Map({\n          container: 'map',\n          style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location\n          center: [-74.5, 40], // starting position [lng, lat]\n          zoom: 10 // starting zoom\n      });\n      var nav = new mapboxgl.NavigationControl();\n      this.$_map.addControl(nav, 'top-left');\n\n    }\n  }\n\n  function fetch_data(obj) {\n    const data_url = 'https://gist.githubusercontent.com/lbud/35e4847d13e5524d08d3e547318cf689/raw/d44940c13e70b2bb683345c511f85d249ee5ccfc/starbucks.csv';\n    axios.get(data_url, {\n      params: {},\n    }).then(({ data }) => {\n      // split into lines\n      let lines = 0;\n      for (var l of data.split(\"\\n\")) {\n        // skip the first line\n        if (lines>0) {\n          let sb = {\n            phone_number: '',\n            street: '',\n            city: '',\n            lat: 0.0,\n            lng: 0.0\n          };\n          // split by comma\n          let items = parse_csv(l);\n          //console.log(items);\n          if (items.length==19) {\n            sb.phone_number = items[5];\n            sb.street = items[7];\n            sb.city = items[11];\n            sb.lat = parseFloat(items[14]);\n            sb.lng = parseFloat(items[15]);\n            obj.$_pois.push(sb);\n            console.log(sb);\n            // adding a marker\n            var marker = new mapboxgl.Marker({color:'#00704a'});\n            marker.setLngLat([sb.lng, sb.lat]);\n            marker.setPopup(new mapboxgl.Popup().\n              setHTML(`<div class=\"poipopup\">Address: ${sb.street}</div>\n                       <div class=\"poipopup\">Phone: ${sb.phone_number}</div`));\n            marker.addTo(obj.$_map);\n          }\n        }\n        lines++;\n      }\n      // move the center\n      let c = center(obj.$_pois);\n      obj.$_map.setCenter([c[1], c[0]]);\n    });\n\n  }\n\n  // average of Lat/Lng\n  function center(pois) {\n    let n = pois.length;\n    let lat = 0.0;\n    let lng = 0.0;\n    for (let p of pois) {\n      lat += p.lat;\n      lng += p.lng;\n    }\n    return [lat/n, lng/n];\n  }\n\n  //\n  function parse_csv(str) {\n    let cs = str.split(',');\n    let tmps = \"\";\n    let result = [];\n    for (var itm of cs) {\n      let s = itm.trim();\n      if (tmps.length>0) {\n        tmps += s;\n        if (s.charAt(s.length-1)==='\"') {\n          // closing quote\n          result.push(tmps.substr(0, s.length-2));\n          tmps = '';\n        }\n      } else if (s.charAt(0)==='\"') {\n        // starting quote\n        tmps = s.substr(1, s.length-1);\n      } else {\n        result.push(s);\n      }\n    }\n    return result;\n  }\n  // test...\n  //console.log(parse_csv('US,15298,Grand Central,Starbucks,7800-67600,212-370-4161,CO,\"7800 Grand Central Station, Track 35, Grand Central Station\",7800 Grand Central Station,Track 35,Grand Central Station,New York,NY,10017,40.753669738769531,-73.976791381835938,Eastern Standard Time,-300,GMT-05:00 America/New_York'));\n  //console.log(parse_csv('US,6590,88th & Broadway,Starbucks,14498-121264,212-595-3404,CO,2394 Broadway,2394 Broadway,,,New York,NY,100241703,40.789287567138672,-73.975326538085938,Eastern Standard Time,-300,GMT-05:00 America/New_York'));\n\n  export default MapMixin;\n</script>\n\n<style >\n@import 'https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css';\n</style>\n\n<style >\n.poipopup {\n  font-size: 0.9em;\n  color:#777;\n}\n</style>\n"]}]}